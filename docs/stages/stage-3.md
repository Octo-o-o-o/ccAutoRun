# Stage 3: æ ¸å¿ƒè‡ªåŠ¨åŒ–å¼•æ“ - è®¡åˆ’è§£æå’ŒHook ğŸ”„

**[â† è¿”å›ä¸»è®¡åˆ’](../../EXECUTION_PLAN.md)** | **[â† Stage 2b](stage-2b.md)** | **[Stage 4 â†’](stage-4.md)**

---

## ğŸ“‹ é˜¶æ®µä¿¡æ¯

- **é˜¶æ®µç¼–å·**: Stage 3
- **é¢„è®¡æ—¶é—´**: 6-8å°æ—¶
- **ä¾èµ–**: Stage 2b
- **çŠ¶æ€**: â³ å¾…å¼€å§‹

### ğŸ¯ ç›®æ ‡
å®ç°è®¡åˆ’æ–‡æ¡£è§£æã€ä¼šè¯ç®¡ç†ã€è‡ªåŠ¨ç»§ç»­Hookï¼Œ**å®Œæ•´æ”¯æŒæ‹†åˆ†æ¶æ„**

### ğŸ“ ä»»åŠ¡æ¸…å•

#### 3.1 è®¡åˆ’è§£æå™¨ï¼ˆæ ¸å¿ƒï¼æ”¯æŒä¸¤ç§æ¶æ„ï¼‰
- [ ] å®ç° `src/core/plan-parser.js`
  - **æ£€æµ‹æ¶æ„ç±»å‹**ï¼š
    - å•æ–‡ä»¶ï¼š`xxx.md` å­˜åœ¨ä¸”ä¸æ˜¯ç›®å½•
    - æ‹†åˆ†æ¶æ„ï¼š`xxx/README.md` å­˜åœ¨
  - **å•æ–‡ä»¶è§£æ**ï¼š
    - æå–é…ç½®å¤´ï¼ˆstages, current, auto_continueç­‰ï¼‰
    - è§£ææ¯ä¸ªStageçš„ç»“æ„
    - è®¡ç®—è¿›åº¦ç™¾åˆ†æ¯”
  - **æ‹†åˆ†æ¶æ„è§£æ**ï¼š
    - è¯»å– `README.md` è·å–æ€»ä½“é…ç½®å’Œè¿›åº¦
    - ä½¿ç”¨globæ‰«æ `stages/` ç›®å½•ï¼ˆå¦‚ `01-*.md`, `02-*.md`ï¼‰
    - è¿”å›å½“å‰Stageæ–‡ä»¶è·¯å¾„
    - è®¡ç®—è¿›åº¦ï¼ˆä»README.mdçš„currentå­—æ®µï¼‰
  - **ç»Ÿä¸€æ¥å£**ï¼š
    ```javascript
    {
      type: 'single' | 'split',
      config: { stages, current, auto_continue, ... },
      currentStageFile: 'path/to/current/stage.md', // æ‹†åˆ†æ¶æ„ï¼šstages/02-xxx.md
      allStageFiles: ['stages/01-xxx.md', ...],      // ä»…æ‹†åˆ†æ¶æ„
      readmePath: 'xxx/README.md',                   // ä»…æ‹†åˆ†æ¶æ„
      progress: { completed: 2, total: 5, percentage: 40 }
    }
    ```

#### 3.2 ä¼šè¯ç®¡ç†å’Œå®‰å…¨é™åˆ¶ï¼ˆç®€åŒ–ï¼ï¼‰
- [ ] å®ç° `src/core/session-manager.js`ï¼ˆç®€åŒ–ä¸º 60 è¡Œï¼‰
  - è¯»å–/å†™å…¥ä¼šè¯çŠ¶æ€ï¼ˆ.ccautorun/sessions/xxx.jsonï¼‰
  - ä¼šè¯çŠ¶æ€æ ¼å¼ï¼š
    ```json
    {
      "taskName": "xxx",
      "count": 5,
      "status": "active",  // active / paused / failed / completed
      "currentStage": 3,
      "lastExecuted": "2025-01-06T10:30:00Z",
      "lastSessionId": "abc123",
      "lastError": null    // è®°å½•æœ€åçš„é”™è¯¯ä¿¡æ¯ï¼ˆfailed çŠ¶æ€æ—¶ï¼‰
    }
    ```
  - **åŸå­å†™å…¥**ï¼ˆå…³é”®ï¼é¿å…æ•°æ®æŸåï¼‰ï¼š
    - å…ˆå†™å…¥ä¸´æ—¶æ–‡ä»¶ï¼š`sessions/xxx.json.tmp`
    - ç„¶å `fs.renameSync()` åŸå­æ›¿æ¢ï¼ˆrename æ˜¯åŸå­æ“ä½œï¼‰
    - æ•è·å†™å…¥é”™è¯¯ï¼Œæä¾›è¯¦ç»†æ—¥å¿—
  - æä¾›ç®€å•çš„ CRUD æ–¹æ³•
  - æ— å¤æ‚é€»è¾‘ï¼Œä¿æŒç®€å•
- [ ] å®ç° `src/core/safety-limiter.js`
  - æ£€æŸ¥æ˜¯å¦è¾¾åˆ°å®‰å…¨é™åˆ¶
  - å¯é…ç½®çš„é™åˆ¶ç­–ç•¥
  - è­¦å‘Šå’Œé˜»æ­¢é€»è¾‘

#### 3.3 è‡ªåŠ¨ç»§ç»­Hookï¼ˆå…³é”®ï¼æ”¯æŒæ‹†åˆ†æ¶æ„ + é™çº§ç­–ç•¥ï¼‰
- [ ] å®ç° `src/hooks/auto-continue.js`
  - **æ¥æ”¶Hookæ•°æ®**ï¼š
    - è¯»å–stdinçš„JSONï¼ˆsession_id, transcript_path, cwdï¼‰
    - æ·»åŠ è¶…æ—¶ä¿æŠ¤ï¼ˆ10ç§’å†…å¿…é¡»å®Œæˆï¼‰
    - æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œé¿å… Hook å´©æºƒå½±å“ Claude Code
  - **æ£€æµ‹å®Œæˆæ ‡è®°**ï¼ˆä¸‰å±‚é™çº§ç­–ç•¥ï¼‰ï¼š
    - **ä¸»ç­–ç•¥**ï¼šè§£ætranscriptæœ€å100è¡Œï¼ŒåŒ¹é… `[STAGE_COMPLETE:N]` æ ‡è®°
    - **é™çº§ç­–ç•¥1**ï¼ˆæœªæ£€æµ‹åˆ°æ ‡è®°ï¼‰ï¼š
      - æ£€æŸ¥ç‹¬ç«‹æ ‡è®°æ–‡ä»¶ï¼š`.ccautorun/sessions/<task>.stage-complete`
      - å¦‚æœå­˜åœ¨ï¼Œè¯»å– stage ç¼–å·å¹¶åˆ é™¤æ ‡è®°æ–‡ä»¶
    - **é™çº§ç­–ç•¥2**ï¼ˆä»æœªæ£€æµ‹åˆ°ï¼‰ï¼š
      - æ£€æŸ¥è®¡åˆ’æ–‡æ¡£çš„ä¿®æ”¹æ—¶é—´ï¼ˆREADME.md æˆ– xxx.mdï¼‰
      - å¦‚æœåœ¨æœ€è¿‘ 15 ç§’å†…ä¿®æ”¹ï¼Œå‡è®¾ AI å®Œæˆäº†æ›´æ–°
      - ä»æ–‡æ¡£è¯»å–æœ€æ–°çš„ current å­—æ®µ
    - **æœ€ç»ˆé™çº§**ï¼ˆä»æœªæ£€æµ‹åˆ°ï¼‰ï¼š
      - ç­‰å¾… 10 ç§’é‡æ–°æ£€æŸ¥
      - ä»æœªæ£€æµ‹åˆ°ï¼šå‘é€æ¡Œé¢é€šçŸ¥æé†’ç”¨æˆ·æ‰‹åŠ¨ç»§ç»­
      - è®°å½•è­¦å‘Šæ—¥å¿—ï¼šå»ºè®®ç”¨æˆ·åœ¨è®¡åˆ’ä¸­æ˜ç¡®è¦æ±‚ AI è¾“å‡ºæ ‡è®°æˆ–è¿è¡Œ trigger å‘½ä»¤
      - ä¸é˜»å¡ Hook è¿”å›
  - **è¯†åˆ«å½“å‰ä»»åŠ¡**ï¼š
    - ä»transcriptè§£æ@å¼•ç”¨çš„æ–‡ä»¶è·¯å¾„
    - åˆ¤æ–­æ˜¯å•æ–‡ä»¶è¿˜æ˜¯æ‹†åˆ†æ¶æ„ï¼š
      - å¦‚æœå¼•ç”¨ `xxx/stages/02-xxx.md` â†’ æ‹†åˆ†æ¶æ„ï¼Œä»»åŠ¡å=xxx
      - å¦‚æœå¼•ç”¨ `xxx.md` â†’ å•æ–‡ä»¶ï¼Œä»»åŠ¡å=xxx
  - **è¯»å–è®¡åˆ’é…ç½®**ï¼š
    - ä½¿ç”¨plan-parserè§£æï¼ˆè‡ªåŠ¨å¤„ç†ä¸¤ç§æ¶æ„ï¼‰
    - è·å–totalStages, current, safetyLimit
    - **é”™è¯¯å¤„ç†**ï¼šå¦‚æœè§£æå¤±è´¥ï¼Œè®°å½•é”™è¯¯å¹¶é€šçŸ¥ç”¨æˆ·
  - **æ£€æŸ¥ä¼šè¯çŠ¶æ€**ï¼š
    - è¯»å–ä¼šè¯çŠ¶æ€ï¼Œæ£€æŸ¥æ˜¯å¦ä¸º paused
    - å¦‚æœå·²æš‚åœï¼Œè·³è¿‡è‡ªåŠ¨ç»§ç»­ï¼Œå‘é€é€šçŸ¥
  - **æ£€æŸ¥å®‰å…¨é™åˆ¶**ï¼š
    - è¯»å–ä¼šè¯è®¡æ•°
    - åˆ¤æ–­æ˜¯å¦è¾¾åˆ°limit
    - è¾¾åˆ°é™åˆ¶ï¼šåœæ­¢è‡ªåŠ¨ç»§ç»­ï¼Œå‘é€é€šçŸ¥
  - **æ£€æµ‹é”™è¯¯çŠ¶æ€**ï¼š
    - åœ¨transcriptä¸­æœç´¢é”™è¯¯æ¨¡å¼ï¼ˆ"error", "failed", "exception" ç­‰ï¼‰
    - å¦‚æœæ£€æµ‹åˆ°é”™è¯¯ï¼Œæ£€æŸ¥ä¸¥é‡æ€§
    - ä¸¥é‡é”™è¯¯ï¼ˆç¼–è¯‘å¤±è´¥ã€æµ‹è¯•å¤±è´¥ç­‰ï¼‰ï¼š
      - å°†ä¼šè¯çŠ¶æ€è®¾ç½®ä¸º `failed`
      - è®°å½• `lastError` å­—æ®µ
      - å‘é€é”™è¯¯é€šçŸ¥
      - åœæ­¢è‡ªåŠ¨ç»§ç»­
      - æç¤ºç”¨æˆ·ä½¿ç”¨ `ccautorun retry` æˆ– `recover` å‘½ä»¤
  - **æ›´æ–°è¿›åº¦**ï¼š
    - **æ‹†åˆ†æ¶æ„**ï¼šæ›´æ–° `README.md` çš„currentå­—æ®µ
    - **å•æ–‡ä»¶**ï¼šæ›´æ–°é…ç½®å¤´çš„currentå­—æ®µ
    - **é”™è¯¯å¤„ç†**ï¼ˆå…³é”®ï¼ï¼‰ï¼š
      - å¦‚æœæ›´æ–°å¤±è´¥ï¼ˆæ–‡ä»¶é”å®šã€æƒé™ä¸è¶³ã€æ ¼å¼é”™è¯¯ï¼‰
      - è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—ï¼ˆåŒ…æ‹¬å †æ ˆä¿¡æ¯ï¼‰
      - å°†ä¼šè¯çŠ¶æ€è®¾ç½®ä¸º `failed`
      - è®°å½• `lastError`: "Failed to update progress in README.md"
      - å‘é€é”™è¯¯é€šçŸ¥ï¼ŒåŒ…å«å…·ä½“åŸå› å’Œä¿®å¤å»ºè®®
      - åœæ­¢è‡ªåŠ¨ç»§ç»­ï¼ˆé¿å…æ— é™å¾ªç¯ï¼‰
      - å»ºè®®ç”¨æˆ·è¿è¡Œ `ccautorun doctor` æˆ– `recover` è¯Šæ–­
  - **è‡ªåŠ¨ç»§ç»­**ï¼ˆå…³é”®ï¼æ”¯æŒè·³è¿‡æƒé™ï¼‰ï¼š
    - è¯»å–configä¸­çš„`auto_continue.skip_permissions`é…ç½®
    - æ„å»ºclaudeå‘½ä»¤ï¼š
      ```javascript
      const skipPerms = config.auto_continue?.skip_permissions ? '--dangerously-skip-permissions' : '';
      ```
    - **æ‹†åˆ†æ¶æ„**ï¼š
      ```javascript
      const nextStageFile = `xxx/stages/${String(current+1).padStart(2, '0')}-*.md`;
      const nextFile = glob.sync(nextStageFile)[0];
      exec(`claude ${skipPerms} --resume ${session_id} "@${nextFile} å¼€å§‹æ‰§è¡Œ"`);
      ```
    - **å•æ–‡ä»¶**ï¼š
      ```javascript
      exec(`claude ${skipPerms} --resume ${session_id} "@xxx.md ç»§ç»­æ‰§è¡ŒStage ${current+1}"`);
      ```
  - **å‘é€é€šçŸ¥**ï¼šæ¡Œé¢é€šçŸ¥æç¤ºè¿›åº¦

#### 3.4 é…ç½®å’Œå‘½ä»¤
- [ ] åˆ›å»º `.claude/hooks.yaml` æ¨¡æ¿
  ```yaml
  hooks:
    - event: Stop
      command: node src/hooks/auto-continue.js
      description: Auto-continue to next stage
      enabled: false  # é»˜è®¤å…³é—­ï¼Œç”¨æˆ·æ‰‹åŠ¨å¯ç”¨
  ```
- [ ] å®ç° `ccautorun trigger <task-name>` å‘½ä»¤ï¼ˆæ‰‹åŠ¨è§¦å‘ Hookï¼‰
  - æ‰‹åŠ¨è§¦å‘ä¸‹ä¸€ä¸ª Stage çš„è‡ªåŠ¨ç»§ç»­
  - ç”¨äº Hook å¤±è´¥æˆ–æ£€æµ‹ä¸åˆ°æ ‡è®°æ—¶çš„é™çº§æ–¹æ¡ˆ
  - è¯»å–æœ€åçš„ session_idï¼ˆä»ä¼šè¯çŠ¶æ€ï¼‰
  - æ‰§è¡Œä¸ Hook ç›¸åŒçš„é€»è¾‘ï¼ˆæ›´æ–°è¿›åº¦ + claude --resumeï¼‰
  - ä¸ä¾èµ– transcript è§£æ
- [ ] å®ç° `ccautorun reset [task-name]` å‘½ä»¤
  - é‡ç½®æŒ‡å®šä»»åŠ¡çš„ä¼šè¯è®¡æ•°
  - æ”¯æŒä¸¤ç§æ¶æ„
  - å¯é€‰ï¼šé‡ç½®åˆ°æŒ‡å®š Stageï¼ˆ`--stage N`ï¼‰

### âœ… å®Œæˆæ ‡å‡†
- [ ] plan-parserå¯ä»¥æ­£ç¡®è§£æ**ä¸¤ç§æ¶æ„**çš„è®¡åˆ’æ–‡æ¡£
- [ ] plan-parserå¯ä»¥å‡†ç¡®è¯†åˆ«æ¶æ„ç±»å‹
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šplan-parserå¯ä»¥æ‰«æå¹¶è¿”å›æ‰€æœ‰stageæ–‡ä»¶
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šplan-parserå¼ºåˆ¶ç²¾ç¡®åŒ¹é…æ–‡ä»¶åï¼ˆ`01-name.md`ï¼‰ï¼Œé¿å… backup æ–‡ä»¶
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šplan-parserå¯ä»¥è¿”å›ä¸‹ä¸€ä¸ªstageæ–‡ä»¶è·¯å¾„
- [ ] **session-manager ä½¿ç”¨åŸå­å†™å…¥**ï¼šwrite to tmp + rename
- [ ] session-manager ç®€åŒ–ä¸º 60 è¡Œå·¦å³ï¼Œåªæä¾› CRUD åŠŸèƒ½
- [ ] **ä¼šè¯çŠ¶æ€æ”¯æŒ failed**ï¼šåŒ…å« lastError å­—æ®µ
- [ ] safety-limiterå¯ä»¥æ­£ç¡®åˆ¤æ–­é™åˆ¶
- [ ] Hookå¯ä»¥æ¥æ”¶stdinå¹¶è§£æï¼Œæœ‰è¶…æ—¶ä¿æŠ¤å’Œå¼‚å¸¸æ•è·
- [ ] Hookå¯ä»¥è¯†åˆ«è®¡åˆ’æ–‡ä»¶è·¯å¾„ï¼ˆå•æ–‡ä»¶æˆ–stages/xx-xxx.mdï¼‰
- [ ] Hookå¯ä»¥æ£€æµ‹é˜¶æ®µå®Œæˆæ ‡è®°
- [ ] **Hookä¸‰å±‚é™çº§ç­–ç•¥æœ‰æ•ˆ**ï¼š
  - ä¸»ç­–ç•¥ï¼štranscriptæ ‡è®°
  - é™çº§1ï¼šç‹¬ç«‹æ ‡è®°æ–‡ä»¶
  - é™çº§2ï¼šæ–‡ä»¶ä¿®æ”¹æ—¶é—´
  - æœ€ç»ˆï¼šé€šçŸ¥ç”¨æˆ·
- [ ] **Hookå¯ä»¥æ£€æµ‹é”™è¯¯å¹¶è®¾ç½® failed çŠ¶æ€**
- [ ] Hookå¯ä»¥æ£€æŸ¥ä¼šè¯çŠ¶æ€ï¼ˆpaused/failed æ—¶ä¸ç»§ç»­ï¼‰
- [ ] **Hooké”™è¯¯å¤„ç†å®Œå–„**ï¼šæ›´æ–°è¿›åº¦å¤±è´¥æ—¶è®°å½•è¯¦ç»†æ—¥å¿—ã€è®¾ç½® failedã€å‘é€é€šçŸ¥ã€åœæ­¢ç»§ç»­
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šHookå¯ä»¥æ­£ç¡®æ›´æ–°README.mdçš„è¿›åº¦
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šHookå¯ä»¥æ‰¾åˆ°ä¸‹ä¸€ä¸ªstageæ–‡ä»¶å¹¶è‡ªåŠ¨ç»§ç»­
- [ ] **å•æ–‡ä»¶**ï¼šHookå¯ä»¥æ­£ç¡®æ›´æ–°é…ç½®å¤´å¹¶è‡ªåŠ¨ç»§ç»­
- [ ] Hookå¯ä»¥æ‰§è¡Œclaude --resumeå‘½ä»¤
- [ ] trigger å‘½ä»¤å¯ä»¥æ‰‹åŠ¨è§¦å‘ä¸‹ä¸€ä¸ª Stage
- [ ] resetå‘½ä»¤å¯ä»¥é‡ç½®ä¼šè¯ï¼Œæ”¯æŒ --stage N

### ğŸ“¤ é¢„æœŸè¾“å‡º
- [ ] `src/core/plan-parser.js` (400è¡Œï¼Œå¢åŠ æ‹†åˆ†æ¶æ„æ”¯æŒå’Œç²¾ç¡®æ–‡ä»¶ååŒ¹é…ï¼‰
- [ ] `src/core/session-manager.js` (80è¡Œï¼Œå¢åŠ åŸå­å†™å…¥å’Œ failed çŠ¶æ€ï¼‰
- [ ] `src/core/safety-limiter.js` (80è¡Œ)
- [ ] `src/hooks/auto-continue.js` (650è¡Œï¼Œå¢åŠ ä¸‰å±‚é™çº§ç­–ç•¥ã€é”™è¯¯æ£€æµ‹å’Œ failed çŠ¶æ€å¤„ç†ï¼‰
- [ ] `src/commands/reset.js` (80è¡Œï¼Œå¢åŠ  --stage æ”¯æŒï¼‰
- [ ] `src/commands/trigger.js` (100è¡Œï¼Œæ–°å¢ï¼‰
- [ ] `.claude/hooks.yaml` (æ¨¡æ¿)

### âš ï¸ æ³¨æ„äº‹é¡¹
- **æ‹†åˆ†æ¶æ„è·¯å¾„è§£ææ˜¯å…³é”®**ï¼šæ­£ç¡®è¯†åˆ« `xxx/stages/02-api.md` ä¸­çš„ä»»åŠ¡å"xxx"
- **åŸå­å†™å…¥è‡³å…³é‡è¦**ï¼š
  - ä½¿ç”¨ `fs.writeFileSync(tmp) + fs.renameSync()` ä¿è¯åŸå­æ€§
  - ä¸ä½¿ç”¨ SQLiteï¼Œå¤æ‚åº¦å¤ªé«˜ä¸”å…¼å®¹æ€§å·®
- **failed çŠ¶æ€æ˜¯é”™è¯¯æ¢å¤çš„å…³é”®**ï¼š
  - Hook æ£€æµ‹åˆ°é”™è¯¯æ—¶è®¾ç½® failed
  - retry/recover å‘½ä»¤ä» failed æ¢å¤
  - è®°å½•è¯¦ç»†çš„ lastError ä¿¡æ¯
- **Hook å¯é æ€§è‡³å…³é‡è¦**ï¼š
  - å¿…é¡»æœ‰è¶…æ—¶ä¿æŠ¤ï¼ˆ10ç§’ï¼‰
  - å¿…é¡»æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œä¸èƒ½å´©æºƒ
  - **ä¸‰å±‚é™çº§ç­–ç•¥**ï¼š
    1. transcript æ ‡è®°ï¼ˆæœ€å¯é ï¼‰
    2. ç‹¬ç«‹æ ‡è®°æ–‡ä»¶ï¼ˆå¤‡é€‰ï¼‰
    3. æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼ˆå…œåº•ï¼‰
    4. é€šçŸ¥ç”¨æˆ·ï¼ˆæœ€ç»ˆï¼‰
  - é”™è¯¯é€šçŸ¥å¿…é¡»åŒ…å«ä¿®å¤å»ºè®®å’Œ `ccautorun doctor` æˆ– `recover` æç¤º
- Hookéœ€è¦èƒ½å¤„ç†stdinçš„JSONæ•°æ®
- transcriptæ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼Œåªè¯»å–æœ€å100è¡Œ
- æ­£åˆ™è¡¨è¾¾å¼è¦ç²¾ç¡®åŒ¹é… `[STAGE_COMPLETE:N]`
- claudeå‘½ä»¤æ‰§è¡Œè¦å¼‚æ­¥ï¼Œä¸é˜»å¡Hookè¿”å›
- **ç‹¬ç«‹æ ‡è®°æ–‡ä»¶æœºåˆ¶**ï¼šç®€å•ä¸”å¯é ï¼ŒAI å¯ä»¥åœ¨æ— æ³•è¾“å‡ºæ ‡è®°æ—¶åˆ›å»ºæ–‡ä»¶
- **skip_permissionsè‡³å…³é‡è¦**ï¼š
  - é»˜è®¤ä½¿ç”¨`--dangerously-skip-permissions`è·³è¿‡æƒé™ç¡®è®¤
  - å¦åˆ™è‡ªåŠ¨ç»§ç»­ä¼šè¢«æƒé™å¼¹çª—ä¸­æ–­ï¼Œå¤±å»è‡ªåŠ¨åŒ–æ„ä¹‰
  - ç¡®ä¿ä»config.yamlæ­£ç¡®è¯»å–æ­¤é…ç½®
  - å¦‚æœconfigä¸­è®¾ç½®ä¸ºfalseï¼Œéœ€è®°å½•è­¦å‘Šï¼ˆè‡ªåŠ¨åŒ–å°†å¤±è´¥ï¼‰
- **Stage æ–‡ä»¶åæ ¼å¼å¼ºåˆ¶ç²¾ç¡®åŒ¹é…**ï¼ˆé‡è¦ï¼ï¼‰ï¼š
  - åªåŒ¹é… `01-*.md`, `02-*.md` ç­‰æ ¼å¼
  - å¦‚æœåŒ¹é…åˆ°å¤šä¸ªæ–‡ä»¶ï¼ŒæŠ¥é”™è€Œä¸æ˜¯çŒœæµ‹
  - å»ºè®®ç”¨æˆ·æ£€æŸ¥å¹¶åˆ é™¤ backup/old/draft æ–‡ä»¶
  - ä¸åšæ™ºèƒ½é€‰æ‹©ï¼Œé¿å…è¯¯åˆ¤
- **æ›´æ–°README.mdæ—¶ä¿æŒæ ¼å¼**ï¼šåªä¿®æ”¹currentå­—æ®µï¼Œä¸ç ´åå…¶ä»–å†…å®¹
- **READMEæ›´æ–°å¤±è´¥å¤„ç†**ï¼ˆå…³é”®ï¼ï¼‰ï¼š
  - è®°å½•è¯¦ç»†é”™è¯¯ï¼ˆæ–‡ä»¶é”å®šã€æƒé™ã€æ ¼å¼é”™è¯¯ç­‰ï¼‰
  - å‘é€é”™è¯¯é€šçŸ¥ï¼ŒåŒ…å«å…·ä½“åŸå› 
  - åœæ­¢è‡ªåŠ¨ç»§ç»­ï¼ˆé¿å…æ— é™å¾ªç¯ï¼‰
  - æç¤ºç”¨æˆ·è¿è¡Œ `ccautorun doctor` è¯Šæ–­
  - æç¤ºç”¨æˆ·æ£€æŸ¥ README.md æ ¼å¼
- **session-manager ç®€åŒ–**ï¼šåªåšç®€å•çš„ CRUDï¼Œæ— å¤æ‚é€»è¾‘
- **é”™è¯¯å¤„ç†**ï¼šå¦‚æœæ‰¾ä¸åˆ°ä¸‹ä¸€ä¸ªstageæ–‡ä»¶ï¼ŒæŠ¥é”™è€Œä¸æ˜¯crash
- **Windows å…¼å®¹æ€§**ï¼šä½¿ç”¨ Node.js fs APIï¼Œä¸ä¾èµ– shell å‘½ä»¤

### ğŸ§ª éªŒè¯å‘½ä»¤
```bash
# æµ‹è¯•plan-parser
node -e "import('./src/core/plan-parser.js').then(m => console.log(m.parsePlan('test.md')))"

# æµ‹è¯• session-managerï¼ˆéªŒè¯ç®€åŒ–ååŠŸèƒ½ï¼‰
node -e "import('./src/core/session-manager.js').then(m => {
  m.create('test', {stage: 1});
  console.log(m.read('test'));
})"
# åº”è¯¥ç®€å•æ˜äº†ï¼Œåªæœ‰åŸºæœ¬çš„ CRUD

# æµ‹è¯• Hookï¼ˆæ¨¡æ‹Ÿæ­£å¸¸æµç¨‹ï¼‰
echo '{"session_id":"test","transcript_path":"/tmp/test.txt","cwd":"/tmp"}' | node src/hooks/auto-continue.js
# åº”åœ¨ 10 ç§’å†…å®Œæˆï¼Œä¸å´©æºƒ

# æµ‹è¯• Hookï¼ˆæ¨¡æ‹Ÿæ— æ ‡è®°åœºæ™¯ï¼‰
# åˆ›å»ºä¸€ä¸ªæ²¡æœ‰ [STAGE_COMPLETE] çš„ transcript
echo "some output without marker" > /tmp/test-no-marker.txt
echo '{"session_id":"test","transcript_path":"/tmp/test-no-marker.txt","cwd":"/tmp"}' | node src/hooks/auto-continue.js
# åº”å‘é€é€šçŸ¥ï¼Œä¸å´©æºƒ

# æµ‹è¯• triggerï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰
ccautorun trigger test-task
# åº”æ‰‹åŠ¨è§¦å‘ä¸‹ä¸€ä¸ª Stage

# æµ‹è¯• reset
ccautorun reset test-task
ccautorun reset test-task --stage 2
```

---


# Stage 5: é€šçŸ¥ã€CLIå¢å¼ºå’Œç‰ˆæœ¬ç®¡ç† ğŸ”„

**[â† è¿”å›ä¸»è®¡åˆ’](../../EXECUTION_PLAN.md)** | **[â† Stage 4](stage-4.md)** | **[Stage 5.5 â†’](stage-5.5.md)**

---

## ğŸ“‹ é˜¶æ®µä¿¡æ¯

- **é˜¶æ®µç¼–å·**: Stage 5
- **é¢„è®¡æ—¶é—´**: 4-6å°æ—¶
- **ä¾èµ–**: Stage 4
- **çŠ¶æ€**: â³ å¾…å¼€å§‹

### ğŸ¯ ç›®æ ‡
å®ç°æ¡Œé¢é€šçŸ¥ï¼ˆå†…ç½®åˆ°Hookï¼‰ã€å®æ—¶è¿›åº¦ç›‘æ§ï¼ˆwatchï¼‰ã€é…ç½®è¿ç§»ï¼Œ**å®Œæ•´æ”¯æŒæ‹†åˆ†æ¶æ„**

### ğŸ“ ä»»åŠ¡æ¸…å•
- [ ] å®ç° `ccautorun watch <task-name>` å‘½ä»¤ï¼ˆå®æ—¶è¿›åº¦æ˜¾ç¤ºï¼Œå…³é”®ï¼ï¼‰
  - **é»˜è®¤å¼€å¯**ï¼šæ‰§è¡Œä»»åŠ¡æ—¶è‡ªåŠ¨å¯åŠ¨ watch
  - å®æ—¶æ˜¾ç¤ºä»»åŠ¡è¿›åº¦ï¼š
    - å½“å‰ Stageï¼ˆå¦‚ "Stage 2/5: API Implementation"ï¼‰
    - å®Œæˆç™¾åˆ†æ¯”ï¼ˆ40%ï¼‰
    - è¿›åº¦æ¡å¯è§†åŒ–ï¼ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ï¼‰
    - å·²ç”¨æ—¶é—´ï¼ˆå¦‚ "Elapsed: 12m 34s"ï¼‰
    - é¢„è®¡å‰©ä½™æ—¶é—´ï¼ˆåŸºäºå¹³å‡é€Ÿåº¦ï¼‰
  - ç›‘æ§æ–¹å¼ï¼š
    - ä½¿ç”¨ chokidar ç›‘æ§ä¼šè¯æ–‡ä»¶å’Œè®¡åˆ’æ–‡æ¡£çš„å˜åŒ–
    - æ£€æµ‹ä¼šè¯çŠ¶æ€å˜åŒ–ï¼ˆactive/paused/failed/completedï¼‰
    - æ£€æµ‹è¿›åº¦å˜åŒ–ï¼ˆcurrent å­—æ®µï¼‰
  - çŠ¶æ€å˜åŒ–é€šçŸ¥ï¼š
    - Stage å®Œæˆæ—¶æ˜¾ç¤ºé€šçŸ¥
    - å‡ºç°é”™è¯¯æ—¶æ˜¾ç¤ºè­¦å‘Š
    - ä»»åŠ¡å®Œæˆæ—¶æ˜¾ç¤ºæ€»ç»“
  - æ”¯æŒ `--interval <seconds>` è®¾ç½®åˆ·æ–°é—´éš”ï¼ˆé»˜è®¤ 2 ç§’ï¼‰
  - æ”¯æŒ `--no-notify` ç¦ç”¨æ¡Œé¢é€šçŸ¥
  - æ”¯æŒ Ctrl+C ä¼˜é›…é€€å‡º
- [ ] å®ç° `src/utils/notifier.js`
  - ä½¿ç”¨node-notifierè·¨å¹³å°é€šçŸ¥
  - æ”¯æŒæ ‡é¢˜ã€æ¶ˆæ¯ã€å›¾æ ‡ã€å£°éŸ³ï¼ˆåŸºäºé…ç½®ï¼‰
  - é”™è¯¯å¤„ç†ï¼ˆé€šçŸ¥å¤±è´¥ä¸å½±å“ä¸»æµç¨‹ï¼‰
  - æä¾›ç»Ÿä¸€çš„é€šçŸ¥æ¥å£ï¼š
    - `notifyProgress(taskName, stage, total)` - è¿›åº¦é€šçŸ¥
    - `notifyError(taskName, error, suggestion)` - é”™è¯¯é€šçŸ¥
    - `notifyComplete(taskName, stats)` - å®Œæˆé€šçŸ¥
    - `notifyWarning(taskName, message)` - è­¦å‘Šé€šçŸ¥
- [ ] å°†é€šçŸ¥åŠŸèƒ½é›†æˆåˆ° Hookï¼ˆ`src/hooks/auto-continue.js`ï¼‰
  - Stage å¼€å§‹æ—¶å‘é€é€šçŸ¥
  - Stage å®Œæˆæ—¶å‘é€é€šçŸ¥ï¼ˆå¸¦è¿›åº¦ç™¾åˆ†æ¯”ï¼‰
  - é”™è¯¯æ—¶å‘é€é€šçŸ¥
  - æš‚åœ/è¾¾åˆ°é™åˆ¶æ—¶å‘é€é€šçŸ¥
  - æ ¹æ® config.yaml çš„ `notifications.progress_frequency` æ§åˆ¶é¢‘ç‡
- [ ] å®ç° `ccautorun config` å‘½ä»¤ï¼ˆå¢å¼ºï¼‰
  - äº¤äº’å¼é…ç½®å‘å¯¼ï¼ˆinquirerï¼‰
  - é…ç½®é¡¹ï¼š
    - é»˜è®¤æ¶æ„ç±»å‹ï¼ˆauto/split/singleï¼‰
    - å®‰å…¨é™åˆ¶ç­–ç•¥ï¼ˆunlimited/æ•°å­—ï¼‰
    - é€šçŸ¥åå¥½ï¼ˆenabled, sound, progress_frequencyï¼‰
    - è‡ªåŠ¨ç»§ç»­å¼€å…³ï¼ˆenabled, skip_permissionsï¼‰
    - é»˜è®¤ç¼–è¾‘å™¨ï¼ˆcode, vim, etcï¼‰
  - æ”¯æŒ `--get <key>` æŸ¥è¯¢å•ä¸ªé…ç½®
  - æ”¯æŒ `--set <key> <value>` ä¿®æ”¹å•ä¸ªé…ç½®
  - æ”¯æŒ `--list` åˆ—å‡ºæ‰€æœ‰é…ç½®
  - é…ç½®éªŒè¯ï¼ˆä½¿ç”¨ config-validatorï¼‰
  - ä¿å­˜åˆ° `.ccautorun/config.yaml`
- [ ] å®ç° `ccautorun migrate` å‘½ä»¤ï¼ˆç‰ˆæœ¬è¿ç§»ï¼‰
  - æ£€æŸ¥ config.yaml çš„ version å­—æ®µ
  - å¦‚æœç‰ˆæœ¬è¿‡æ—§ï¼Œæç¤ºéœ€è¦è¿ç§»
  - æ‰§è¡Œè‡ªåŠ¨è¿ç§»ï¼š
    - v1.x â†’ v2.0: æ·»åŠ æ–°å­—æ®µï¼Œä¿ç•™æ—§é…ç½®
    - æ›´æ–° version å­—æ®µ
  - å¤‡ä»½æ—§é…ç½®ï¼ˆ`config.yaml.backup`ï¼‰
  - è¾“å‡ºè¿ç§»æ—¥å¿—
  - æ”¯æŒ `--dry-run` é¢„è§ˆè¿ç§»
- [ ] å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥é…ç½®ç‰ˆæœ¬
  - åœ¨ `src/cli.js` ä¸­æ·»åŠ ç‰ˆæœ¬æ£€æŸ¥
  - å¦‚æœç‰ˆæœ¬ä¸åŒ¹é…ï¼Œæç¤ºè¿è¡Œ `ccautorun migrate`
  - ä¸é˜»æ­¢å‘½ä»¤æ‰§è¡Œï¼ˆé™¤éé…ç½®æ ¼å¼å®Œå…¨æ— æ³•è§£æï¼‰
- [ ] å®ç° `ccautorun archive [task-name]` å‘½ä»¤ï¼ˆæ”¯æŒæ‹†åˆ†æ¶æ„ï¼‰
  - å°†å®Œæˆçš„ä»»åŠ¡ç§»åˆ° `.ccautorun/archive/`
  - **æ‹†åˆ†æ¶æ„**ï¼šç§»åŠ¨æ•´ä¸ªç›®å½• `xxx/`
  - **å•æ–‡ä»¶**ï¼šç§»åŠ¨ `xxx.md`
  - ä¿ç•™ä¼šè¯å†å²æ–‡ä»¶
  - è¾“å‡ºç®€å•æ‘˜è¦ï¼ˆä»»åŠ¡åã€å®ŒæˆStageæ•°ã€æ€»è€—æ—¶ï¼‰
- [ ] å¢å¼º `ccautorun list` å‘½ä»¤ï¼ˆæ‹†åˆ†æ¶æ„å¯è§†åŒ–ï¼‰
  - æ·»åŠ è¿›åº¦æ¡å¯è§†åŒ–
  - å½©è‰²çŠ¶æ€æ˜¾ç¤º
  - **æ˜¾ç¤ºæ¶æ„ç±»å‹æ ‡è¯†**ï¼šğŸ“ (split) æˆ– ğŸ“„ (single)
  - æ”¯æŒ `--filter` é€‰é¡¹ï¼ˆè¿›è¡Œä¸­/å·²å®Œæˆï¼‰
  - **æ‹†åˆ†æ¶æ„é¢å¤–ä¿¡æ¯**ï¼šStageæ–‡ä»¶æ•°é‡
- [ ] å¢å¼º `ccautorun status` å‘½ä»¤ï¼ˆæ‹†åˆ†æ¶æ„è¯¦ç»†æ˜¾ç¤ºï¼‰
  - æ˜¾ç¤ºå®Œæ•´çš„é˜¶æ®µæ ‘ï¼š
    - **å•æ–‡ä»¶**ï¼šåˆ—å‡ºStage 1, 2, 3...
    - **æ‹†åˆ†æ¶æ„**ï¼šåˆ—å‡º `stages/01-xxx.md`, `02-yyy.md`...
  - ä»»åŠ¡å®Œæˆæƒ…å†µ
  - **æ‹†åˆ†æ¶æ„**ï¼šæ˜¾ç¤ºæ¯ä¸ªStageæ–‡ä»¶å¤§å°å’Œtokenä¼°ç®—
  - ä¼šè¯å†å²

### âœ… å®Œæˆæ ‡å‡†
- [ ] **watch å‘½ä»¤å¯ä»¥å®æ—¶æ˜¾ç¤ºè¿›åº¦**ï¼ˆå…³é”®ï¼ï¼‰
- [ ] watch é»˜è®¤å¼€å¯ï¼ˆæ‰§è¡Œä»»åŠ¡æ—¶è‡ªåŠ¨å¯åŠ¨ï¼‰
- [ ] watch å¯ä»¥ç›‘æ§ä¼šè¯å’Œè®¡åˆ’æ–‡æ¡£å˜åŒ–
- [ ] watch æ˜¾ç¤ºè¿›åº¦æ¡ã€ç™¾åˆ†æ¯”ã€å·²ç”¨æ—¶é—´ã€é¢„è®¡å‰©ä½™æ—¶é—´
- [ ] watch æ£€æµ‹åˆ°çŠ¶æ€å˜åŒ–æ—¶å‘é€é€šçŸ¥
- [ ] watch æ”¯æŒ --interval å’Œ --no-notify é€‰é¡¹
- [ ] watch å¯ä»¥ä¼˜é›…é€€å‡ºï¼ˆCtrl+Cï¼‰
- [ ] æ¡Œé¢é€šçŸ¥åœ¨Mac/Win/Linuxä¸Šéƒ½èƒ½å·¥ä½œ
- [ ] notifier æä¾›ç»Ÿä¸€æ¥å£ï¼ˆprogress/error/complete/warningï¼‰
- [ ] **Hook é›†æˆé€šçŸ¥**ï¼šStage å¼€å§‹/å®Œæˆ/é”™è¯¯æ—¶è‡ªåŠ¨é€šçŸ¥
- [ ] é€šçŸ¥é¢‘ç‡å¯é…ç½®ï¼ˆevery-stage / every-2-stages / offï¼‰
- [ ] configå‘½ä»¤å¯ä»¥äº¤äº’å¼é…ç½®æ‰€æœ‰é¡¹
- [ ] configæ”¯æŒ --get/--set/--list å­å‘½ä»¤
- [ ] configå¯ä»¥é…ç½®é»˜è®¤æ¶æ„ç±»å‹ã€é€šçŸ¥ã€ç¼–è¾‘å™¨ç­‰
- [ ] é…ç½®ä¿å­˜åˆ°yamlæ–‡ä»¶å¹¶é€šè¿‡éªŒè¯
- [ ] **migrate å‘½ä»¤å·¥ä½œæ­£å¸¸**ï¼š
  - å¯ä»¥æ£€æµ‹é…ç½®ç‰ˆæœ¬
  - å¯ä»¥æ‰§è¡Œè‡ªåŠ¨è¿ç§»
  - æ”¯æŒ --dry-run
  - å¤‡ä»½æ—§é…ç½®
- [ ] å¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥é…ç½®ç‰ˆæœ¬å¹¶æç¤º
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šarchiveå¯ä»¥æ­£ç¡®ç§»åŠ¨æ•´ä¸ªç›®å½•
- [ ] **å•æ–‡ä»¶**ï¼šarchiveå¯ä»¥æ­£ç¡®ç§»åŠ¨å•ä¸ªæ–‡ä»¶
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šlistæ˜¾ç¤ºğŸ“æ ‡è¯†å’ŒStageæ•°é‡
- [ ] **å•æ–‡ä»¶**ï¼šlistæ˜¾ç¤ºğŸ“„æ ‡è¯†
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šstatusæ˜¾ç¤ºæ‰€æœ‰stageæ–‡ä»¶æ¸…å•
- [ ] **æ‹†åˆ†æ¶æ„**ï¼šstatusæ˜¾ç¤ºæ¯ä¸ªstageæ–‡ä»¶tokenä¼°ç®—
- [ ] listå’Œstatuså‘½ä»¤æœ‰æ¼‚äº®çš„å¯è§†åŒ–è¾“å‡º
- [ ] æ‰€æœ‰å‘½ä»¤å¯¹ä¸¤ç§æ¶æ„éƒ½æœ‰å®Œæ•´çš„é”™è¯¯å¤„ç†

### ğŸ“¤ é¢„æœŸè¾“å‡º
- [ ] `src/commands/watch.js` (250è¡Œï¼Œæ–°å¢ï¼Œä½¿ç”¨ chokidarï¼‰
- [ ] `src/utils/notifier.js` (120è¡Œï¼Œå¢åŠ ç»Ÿä¸€æ¥å£ï¼‰
- [ ] æ›´æ–° `src/hooks/auto-continue.js` (å¢åŠ 100è¡Œï¼Œé›†æˆé€šçŸ¥ï¼‰
- [ ] `src/commands/config.js` (300è¡Œï¼Œå·²åœ¨ Stage 2bï¼‰
- [ ] `src/commands/migrate.js` (180è¡Œï¼Œæ–°å¢ï¼‰
- [ ] æ›´æ–° `src/cli.js` (å¢åŠ 30è¡Œï¼Œç‰ˆæœ¬æ£€æŸ¥ï¼‰
- [ ] `src/commands/archive.js` (150è¡Œï¼Œå¢åŠ æ‹†åˆ†æ¶æ„å½’æ¡£)
- [ ] æ›´æ–° `src/commands/list.js` (å¢åŠ 150è¡Œï¼Œæ¶æ„ç±»å‹æ˜¾ç¤º)
- [ ] æ›´æ–° `src/commands/status.js` (å¢åŠ 120è¡Œï¼Œæ‹†åˆ†æ¶æ„è¯¦ç»†æ˜¾ç¤º)

### âš ï¸ æ³¨æ„äº‹é¡¹
- **watch å‘½ä»¤æ˜¯æ ¸å¿ƒç”¨æˆ·ä½“éªŒ**ï¼š
  - é»˜è®¤å¼€å¯ï¼Œç”¨æˆ·æ— éœ€æ‰‹åŠ¨å¯åŠ¨
  - ä½¿ç”¨ chokidar ç›‘æ§æ–‡ä»¶å˜åŒ–ï¼Œé«˜æ•ˆä¸”è·¨å¹³å°
  - è¿›åº¦æ¡ä½¿ç”¨ Unicode å­—ç¬¦ï¼ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ï¼‰ï¼Œæ³¨æ„ç»ˆç«¯å…¼å®¹æ€§
  - ä¼˜é›…é€€å‡ºï¼ˆCtrl+Cï¼‰ï¼Œæ¸…ç†èµ„æº
  - é¢„è®¡å‰©ä½™æ—¶é—´åŸºäºå¹³å‡é€Ÿåº¦ï¼Œå¯èƒ½ä¸å‡†ç¡®ï¼ˆæç¤ºç”¨æˆ·ï¼‰
- node-notifieråœ¨ä¸åŒå¹³å°è¡Œä¸ºç•¥æœ‰å·®å¼‚ï¼Œéœ€è¦æµ‹è¯•
- **é€šçŸ¥é›†æˆåˆ°Hook**ï¼šä¸éœ€è¦å•ç‹¬çš„ monitor å‘½ä»¤ï¼ŒHook è‡ªåŠ¨å‘é€é€šçŸ¥
- **é€šçŸ¥é¢‘ç‡æ§åˆ¶**ï¼šæ ¹æ® config.yaml çš„ progress_frequency å†³å®šæ˜¯å¦å‘é€
- **migrate å‘½ä»¤ç®€å•å³å¯**ï¼šåªå¤„ç†ç®€å•çš„å­—æ®µæ·»åŠ ï¼Œä¸åšå¤æ‚è¿ç§»
- **ç‰ˆæœ¬æ£€æŸ¥ä¸é˜»å¡**ï¼šå³ä½¿ç‰ˆæœ¬ä¸åŒ¹é…ä¹Ÿå…è®¸å‘½ä»¤æ‰§è¡Œï¼Œåªæ˜¯æç¤º
- inquirerçš„é—®é¢˜è®¾è®¡è¦æ¸…æ™°æ˜“æ‡‚
- **config --get/--set**ï¼šæ”¯æŒåµŒå¥—é”®ï¼ˆå¦‚ `notifications.enabled`ï¼‰
- **å½’æ¡£æ—¶æ£€æŸ¥æ¶æ„ç±»å‹**ï¼šé¿å…è¯¯åˆ æ–‡ä»¶
- **tokenä¼°ç®—**ï¼šæŒ‰æ¯è¡Œ2.5 tokensè®¡ç®—ï¼ˆç²—ç•¥ä¼°ç®—ï¼Œå®é™…å€¼å–å†³äºå†…å®¹å¤æ‚åº¦ï¼‰ï¼Œå»ºè®®å®é™…æµ‹è¯•ä¸­ä½¿ç”¨Claude Codeçš„tokenè®¡æ•°éªŒè¯
- **Windows å…¼å®¹æ€§**ï¼šä½¿ç”¨ Node.js API è¿›è¡Œæ–‡ä»¶æ“ä½œå’Œæ˜¾ç¤º

### ğŸ§ª éªŒè¯å‘½ä»¤
```bash
# æµ‹è¯• watch å‘½ä»¤ï¼ˆå…³é”®ï¼ï¼‰
ccautorun watch test-task
# åº”å®æ—¶æ˜¾ç¤ºè¿›åº¦æ¡ã€ç™¾åˆ†æ¯”ã€å·²ç”¨æ—¶é—´
# æ£€æµ‹åˆ°å˜åŒ–æ—¶è‡ªåŠ¨æ›´æ–°

ccautorun watch test-task --interval 1        # 1ç§’åˆ·æ–°
ccautorun watch test-task --no-notify         # ç¦ç”¨é€šçŸ¥
# Ctrl+C åº”ä¼˜é›…é€€å‡º

# æµ‹è¯•é€šçŸ¥æ¥å£
node -e "import('./src/utils/notifier.js').then(m => {
  m.notifyProgress('test-task', 2, 5);
  m.notifyError('test-task', 'Something wrong', 'Try ccautorun doctor');
})"

# æµ‹è¯•é€šçŸ¥é›†æˆåˆ° Hookï¼ˆæ¨¡æ‹Ÿï¼‰
# Hook æ‰§è¡Œæ—¶åº”è‡ªåŠ¨å‘é€é€šçŸ¥

# æµ‹è¯•configäº¤äº’å¼
ccautorun config
# åº”æ˜¾ç¤ºæ‰€æœ‰é…ç½®é¡¹ï¼ŒåŒ…æ‹¬æ¶æ„ã€é€šçŸ¥ã€ç¼–è¾‘å™¨ç­‰

# æµ‹è¯•config --get
ccautorun config --get default_architecture
# åº”è¾“å‡º: auto (æˆ– split/single)

ccautorun config --get notifications.enabled
# åº”è¾“å‡º: true (æˆ– false)

# æµ‹è¯•config --set
ccautorun config --set default_architecture split
ccautorun config --set notifications.sound false

# æµ‹è¯•config --list
ccautorun config --list
# åº”åˆ—å‡ºæ‰€æœ‰é…ç½®é¡¹å’Œå€¼

# æµ‹è¯•migrate
ccautorun migrate --dry-run
# åº”æ˜¾ç¤ºå°†è¦æ‰§è¡Œçš„è¿ç§»æ“ä½œ

ccautorun migrate
# åº”æ‰§è¡Œè¿ç§»ï¼Œå¤‡ä»½æ—§é…ç½®ï¼Œæ›´æ–°versionå­—æ®µ

# æµ‹è¯•ç‰ˆæœ¬æ£€æŸ¥
# ä¿®æ”¹ config.yaml çš„ version ä¸ºæ—§ç‰ˆæœ¬
ccautorun list
# åº”æ˜¾ç¤ºç‰ˆæœ¬ä¸åŒ¹é…è­¦å‘Šå’Œ migrate æç¤º

# æµ‹è¯•æ‹†åˆ†æ¶æ„çš„list
ccautorun list
# åº”æ˜¾ç¤ºï¼š
# ğŸ“ auth-oauth2-refactor (3/5 stages) [40%] â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘

# æµ‹è¯•æ‹†åˆ†æ¶æ„çš„status
ccautorun status auth-oauth2-refactor
# åº”æ˜¾ç¤ºï¼š
# Architecture: split
# Stages:
#   âœ… 01-database-design.md (850 lines, ~2125 tokens)
#   ğŸ”„ 02-api-implementation.md (920 lines, ~2300 tokens)
#   â³ 03-testing.md (780 lines, ~1950 tokens)

# æµ‹è¯•æ‹†åˆ†æ¶æ„å½’æ¡£
ccautorun archive auth-oauth2-refactor
# åº”ç§»åŠ¨æ•´ä¸ª auth-oauth2-refactor/ ç›®å½•åˆ° .ccautorun/archive/
ls .ccautorun/archive/auth-oauth2-refactor/README.md
```

---

